<html>
<head>
<title>Deployment Instruction - Production</title>
</head>
<body>
<h1>Deployment Instruction - Production</h1>
    <h2>Install PostgreSQL</h2>
    <ol>
        <li><p>(memfis) switch to the root account</p>
            <div style="background-color:silver;"><code># su</code></div></li>
        <li><p>(root) update yum using the following command:</p>
            <div style="background-color:silver;"><code># yum update</code></div></li>
        <li><p>(root) install postgresql using the following command:</p>
            <div style="background-color:silver;"><code># yum install postgresql-server postgresql-contrib</code></div></li>
        <li><p>(root) initialize postgresql database using the following command:</p>
            <div style="background-color:silver;"><code># postgresql-setup initdb</code></div></li>
        <li><p>(root) allow to run postgresql service using the following command:</p>
            <div style="background-color:silver;"><code># systemctl enable postgresql</code></div></li>
        <li><p>(root) run postgresql service using the following command:</p>
            <div style="background-color:silver;"><code># systemctl start postgresql</code></div></li>
        <li><p>(root) modify <b>/var/lib/pgsql/data/pg_hba.conf</b></p>
            <div style="background-color:silver;"><code>>>> START the following line<br/>
local&nbsp;&nbsp;&nbsp;all&nbsp;&nbsp;&nbsp;&nbsp;all&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="red">peer</font><br/>
>>> FINISH</code></div><br/>
to<br/>
<br/>
<div style="background-color:silver;"><code>>>> START /var/lib/pgsql/data/pg_hba.conf<br/>
local&nbsp;&nbsp;&nbsp;all&nbsp;&nbsp;&nbsp;&nbsp;all&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="red">trust</font><br/>
>>> FINISH</code></div>
</li>
        <li><p>(root) restart postgresql using the following command (<i>on custom version of progres the service name will be different, use "systemctl list-units | grep post" to get actual name</i>):</p>
            <div style="background-color:silver;"><code># service postgresql.service restart</code></div></li>
        <li><p>(root) switch to the memfis account</p>
            <div style="background-color:silver;"><code># exit</code></div></li>
        <li><p>(memfis) login into postgresql shell using the following command:</p>
            <div style="background-color:silver;"><code>$ psql -U postgres</code></div></li>
        <li><p>(psql:qirk:postgres) <a id="psql_postgres_password">reset password for postgres user using the following SQL command:</a></p>
            <div style="background-color:silver;"><code>postgres=# ALTER USER postgres WITH PASSWORD '121212';</code></div></li>
        <li><p>(psql:qirk:postgres) exit from postgresql using the following command:</p>
            <div style="background-color:silver;"><code>postgres=# \q</code></div></li>
        <li><p>(memfis) switch to the root account</p>
            <div style="background-color:silver;"><code># su</code></div></li>
        <li><p>(root) modify <b>/var/lib/pgsql/data/pg_hba.conf</b></p>
            <div style="background-color:silver;"><code>>>> START the following line<br/>
local&nbsp;&nbsp;&nbsp;all&nbsp;&nbsp;&nbsp;&nbsp;all&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;trust<br/>
host&nbsp;&nbsp;&nbsp;&nbsp;all&nbsp;&nbsp;&nbsp;&nbsp;all&nbsp;&nbsp;127.0.0.1/32&nbsp;&nbsp;ident<br/>
host&nbsp;&nbsp;&nbsp;&nbsp;all&nbsp;&nbsp;&nbsp;&nbsp;all&nbsp;&nbsp;::1/128&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ident<br/>
>>> FINISH</code></div><br/>
to<br/>
<br/>
<div style="background-color:silver;"><code>
>>> START /var/lib/pgsql/data/pg_hba.conf<br/>
local&nbsp;&nbsp;&nbsp;all&nbsp;&nbsp;&nbsp;&nbsp;all&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="red">md5</font><br/>
host&nbsp;&nbsp;&nbsp;&nbsp;all&nbsp;&nbsp;&nbsp;&nbsp;all&nbsp;&nbsp;127.0.0.1/32&nbsp;&nbsp;<font color="red">md5</font><br/>
host&nbsp;&nbsp;&nbsp;&nbsp;all&nbsp;&nbsp;&nbsp;&nbsp;all&nbsp;&nbsp;::1/128&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="red">md5</font><br/>
>>> FINISH</code></div></li>
        <li><p>(root) modify <b>/var/lib/pgsql/data/postgresql.conf</b> (<a href="#qirk_external_ip">requires external ip</a>)</p>
            <div style="background-color:silver;"><code>>>> START the following line<br/>
<font color="red">#</font>listen_addresses = '<font color="red">localhost</font>'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# what IP address(es) to listen on;<br/>
>>> FINISH</code></div><br/>
to<br/>
<br/>
<div style="background-color:silver;"><code>>>> START /var/lib/pgsql/data/postgresql.conf<br/>
listen_addresses = '<font color="red">&lt;external_ip_of_qirk&gt;</font>'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# what IP address(es) to listen on;<br/>
>>> FINISH</code></div></li>
        <li><p>(root) modify <b>/var/lib/pgsql/data/postgresql.conf</b></p>
            <div style="background-color:silver;"><code>>>> START the following line<br/>
max_connections = <font color="red">100</font> # (change requires restart)<br/>
>>> FINISH</code></div><br/>
to<br/>
<br/>
<div style="background-color:silver;"><code>>>> START /var/lib/pgsql/data/postgresql.conf<br/>
max_connections = <font color="red">250</font> # (change requires restart)<br/>
>>> FINISH</code></div><br/>
and<br/>
<br/>
<div style="background-color:silver;"><code>>>> START the following line<br/>
shared_buffers = <font color="red">32MB</font> # min 128kB<br/>
>>> FINISH</code></div><br/>
to<br/>
<br/>
<div style="background-color:silver;"><code>>>> START /var/lib/pgsql/data/postgresql.conf<br/>
shared_buffers = <font color="red">80MB</font> # min 128kB<br/>
>>> FINISH</code></div></li>
        <li><p>(root) restart postgresql using the following command:</p>
            <div style="background-color:silver;"><code># service postgresql.service restart</code></div></li>
        <li><p>(root) switch to the memfis account</p>
            <div style="background-color:silver;"><code># exit</code></div></li>
        <li><p>(memfis) login into postgresql shell using the following command:</p>
            <div style="background-color:silver;"><code>$ psql -U postgres</code></div></li>
        <li><p>(psql:qirk:postgres) <a id="psql_postgres_password">reset password for postgres user using the following SQL command:</a></p>
            <div style="background-color:silver;"><code>CREATE USER hibernate WITH ENCRYPTED PASSWORD '121212';<br/>
GRANT ALL PRIVILEGES ON ALL TABLES IN SCHEMA public TO hibernate;<br/>
GRANT USAGE, SELECT ON ALL SEQUENCES IN SCHEMA public TO hibernate;</code></div></li>
        <li><p>(psql:qirk:postgres) exit from postgresql using the following command:</p>
            <div style="background-color:silver;"><code>postgres=# \q</code></div></li>
        <li><p>(memfis) change directory to the one with psql dump files:</p>
            <div style="background-color:silver;"><code>$ cp <font color="red">/path/to/dir/with/psql/dump/</font></code></div></li>
        <li><p>(memfis) restore database schema:</p>
            <div style="background-color:silver;"><code>$ pg_restore -C -U postgres clb.dump<br/>
$ pg_restore -C -U postgres clb_auth.dump<br/>
$ pg_restore -C -U postgres clb_notif.dump<br/>
$ pg_restore -C -U postgres clb_stat.dump</code></div></li>
    </ol>
    <h2>Install Apache Active MQ</h2>
    <ol>
        <li><p>download apache active mq for linux from <a href="https://activemq.apache.org/activemq-5159-release">offical website</a> (5.15.9. version)</p>
            <div style="background-color:silver;"><code></code></div></li>
        <li><p>(memfis) change directory to directory of activemq distributive:</p>
            <div style="background-color:silver;"><code>$ cd <font color="red">/path/to/activemq/distributive</font>/</code></div></li>
        <li><p>(memfis) unpack tar.gz distr of apache activemq using the following command:</p>
            <div style="background-color:silver;"><code>$ tar -xzf <font color="red">&lt;filename&gt;</font>.tar.gz</code></div></li>
        <li><p>(memfis) delete tar.gz distr of apache activemq using the following command:</p>
            <div style="background-color:silver;"><code>$ rm <font color="red">&lt;filename&gt;</font>.tar.gz</code></div></li>
        <li><p>(memfis) change directory to conf directory of apache activemq</p>
            <div style="background-color:silver;"><code>$ cd apache-activemq-5.15.9/conf/</code></div></li>
        <li><p>(memfis) modify <b>users.properties</b>: <a id="activemq_clb1_password">add user clb1 instead of the default one</a></p>
            <div style="background-color:silver;"><code>>>> START users.properties<br/>
admin=admin<br/>
>>> FINISH</code></div><br/>
to<br/>
<br/>
<div style="background-color:silver;"><code>>>> START /app/activemq/<font color="red">&lt;activemq_home&gt;</font>/config/conf/users.properties<br/>
clb1=121212<br/>
>>> FINISH</code></div></li>
        <li><p>(memfis) modify <b>activemq.xml</b>: add the following text as <b>LAST</b> child elements of <b>/beans/broker</b> element (<a href="#activemq_clb1_password">requires password</a>)</p>
            <div style="background-color:silver;"><code>>>> START activemq.xml<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;plugins><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;simpleAuthenticationPlugin><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;users><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;authenticationUser username="clb1" password="121212" groups=""/><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/users><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/simpleAuthenticationPlugin><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/plugins><br/>
>>> FINISH</code></div></li>
        <li><p>(memfis) change directory to bin directory of apache activemq using the following command:</p>
            <div style="background-color:silver;"><code>$ cd ../bin/</code></div></li>
        <li><p>(memfis) start activemq using the following command:</p>
            <div style="background-color:silver;"><code>$ activemq start</code></div></li>
    </ol>
    <h2>Install Elastic Search</h2>
    <ol>
        <li><p>download elastic search distributive for linux (<b>*.tar.gz</b>) from <a href="https://www.elastic.co/downloads/past-releases/elasticsearch-7-1-0">official website</a> (7.1.0 version)</p>
            <div style="background-color:silver;"><code></code></div></li>
        <li><p>(memfis) change directory to directory of elasticsearch distributive using the following command:</p>
            <div style="background-color:silver;"><code>$ cd <font color="red">/path/to/elasticsearch/distributive</font>/</code></code></div></li>
        <li><p>(memfis) unpack elastic search distributive using the following command:</p>
            <div style="background-color:silver;"><code>$ tar -xzf <font color="red">&lt;filename&gt;</font>.tar.gz</code></div></li>
        <li><p>(memfis) delete elastic search distributive using the following command:</p>
            <div style="background-color:silver;"><code>$ rm <font color="red">&lt;filename&gt;</font>.tar.gz</code></div></li>
        <li><p>(memfis) change directory to directory of elasticsearch using the following command:</p>
            <div style="background-color:silver;"><code>$ cd elasticsearch-7.1.0/</code></code></div></li>
        <li><p>(memfis) modify <b>config/elasticsearch.yml</b>: add the following text at the end of the file</p>
            <div style="background-color:silver;"><code>>>> START config/elasticsearch.yml<br/>
xpack.security.enabled: true<br/>
xpack.security.authc.accept_default_password: false<br/>
xpack.security.transport.ssl.enabled: true<br/>
<br/>
xpack.security.authc.realms:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;file.realm1:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order: 0<br/>
>>> FINISH</code></div></li>
        <li><p>(memfis) modify <b>config/roles.yml</b>: add the following text at the end of the file</p>
            <div style="background-color:silver;"><code>>>> START config/roles.yml<br/>
clb_users:<br/>
&nbsp;&nbsp;run_as: [ 'clb1' ]<br/>
&nbsp;&nbsp;cluster: [ 'monitor' ]<br/>
&nbsp;&nbsp;indices:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- names: [ 'user', 'task' ]<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;privileges: [ 'all' ]<br/>
>>> FINISH</code></div></li>
        <li><p>(memfis) create user clb1 using the following command (<a id="elasticsearch_clb1_password">type in password after execution</a>):</p>
            <div style="background-color:silver;"><code>$ bin/elasticsearch-users useradd clb1</code></div></li>
        <li><p>(memfis) give user clb1 the role of clb_users using the following command:</p>
            <div style="background-color:silver;"><code>$ bin/elasticsearch-users roles clb1 -a clb_users</code></div></li>
        <li><p>(memfis) switch to the root account</p>
            <div style="background-color:silver;"><code>$ su</code></div></li>
        <li><p>(root) modify <b>/etc/security/limits.conf</b>: add the following text at the end of the file</p>
            <div style="background-color:silver;"><code>>>> START /etc/security/limits.conf<br/>
<font color="red">&lt;username&gt;</font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;nofile&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;65535<br/>
>>> FINISH</code></div></li>
        <li><p>(root) modify <b>/etc/sysctl.conf</b>: add the following text at the end of the file</p>
            <div style="background-color:silver;"><code>>>> START /etc/sysctl.conf<br/>
vm.max_map_count=262144<br/>
>>> FINISH</code></div></li>
        <li><p>(root) save vm.max_map_count configuration</p>
            <div style="background-color:silver;"><code># sysctl --system</code></div></li>
        <li><p>(root) switch to the memfis account</p>
            <div style="background-color:silver;"><code># exit</code></div></li>
        <li><p>(memfis) change directory to bin directory of elasticsearch using the following command:</p>
            <div style="background-color:silver;"><code>$ cd <font color="red">/path/to/elasticsearch</font>/bin/</code></code></div></li>
        <li><p>(memfis) start elasticsearch using the following command:</p>
            <div style="background-color:silver;"><code>$ ./elasticsearch</code></code></div></li>
        <li><p>(memfis) wait for a couple of minutes to see if there are any errors during start, then stop the process</p></li>
        <li><p>(memfis) start elasticsearch as a daemon using the following command:</p>
            <div style="background-color:silver;"><code>$ ./elasticsearch -d</code></code></div></li>
        <li><p>(memfis) <a href="#elasticsearch_elastic_password">set passwords for reserved users using the following command</a>:</p>
            <div style="background-color:silver;"><code>$ ./elasticsearch-setup-passwords interactive</code></div></li>
        <li><p>(memfis) change directory to <font color="red">/path/to/qirk/repo</font>/clb-parent/clb-elasticsearch-datasync/elasticsearch-mapping-scripts/ using the following command:</p>
            <div style="background-color:silver;"><code>$ cd <font color="red">/path/to/qirk/repo</font>/clb-parent/clb-elasticsearch-datasync/elasticsearch-mapping-scripts/</code></code></div></li>
        <li><p>(memfis) execute elasticsearch curl script using the following command (<a href="#elasticsearch_elastic_password">requires password for elastic user</a>):</p>
            <div style="background-color:silver;"><code>$ bash ./_initial-3.12.1.sh<br/>
$ bash ./alter-3.13.1-1.sh</code></div></li>
    </ol>
    <h2>Install Apache Tomcat</h2>
    <ol>
        <li><p>download tomcat 9.0.24 (distr format: tar.gz) from <a href="https://archive.apache.org/dist/tomcat/tomcat-9/v9.0.24/bin/">oficial website</a>;</p>
            <div style="background-color:silver;"><code></code></div></li>
        <li><p>(memfis) change directory to directory of tomcat distributive using the following command:</p>
            <div style="background-color:silver;"><code>$ cd <font color="red">/path/to/tomcat/distributive</font>/</code></div></li>
        <li><p>(memfis) unpack tomcat distr using the following command:</p>
            <div style="background-color:silver;"><code>$ tar -xzf <font color="red">&lt;filename&gt;</font>.tar.gz</code></div></li>
        <li><p>(memfis) delete tomcat distr using the following command:</p>
            <div style="background-color:silver;"><code>$ rm <font color="red">&lt;filename&gt;</font>.tar.gz</code></div></li>
        <li><p>(memfis) change directory to <b>/usr/local/bin/app/tomcat/<font color="red">&lt;tomcat_home&gt;</font>/webapps/</b> using the following command:</p>
            <div style="background-color:silver;"><code>$ cd /usr/local/bin/app/tomcat/<font color="red">&lt;tomcat_home&gt;</font>/webapps/</code></div></li>
        <li><p>(memfis) delete all files/directories in the directory using the following commands:</p>
            <div style="background-color:silver;"><code>$ rm -rf docs/<br/>
$ rm -rf examples/<br/>
$ rm -rf host-manager/<br/>
$ rm -rf manager/<br/>
$ rm -rf ROOT/</code></div></li>
        <li><p>upload the following files that appears after build of local copy of colaba_back to <b>/usr/local/bin/app/tomcat/<font color="red">&lt;tomcat_home&gt;</font>/lib/</b>:</p>
            <div style="background-color:silver;"><code>/back/clb-parent/clb-common/clb-common-deps-amazonaws/target/clb-common-deps-amazonaws-3.13.1-CUT-jar-with-dependencies.jar<br/>
/back/clb-parent/clb-common/clb-common-deps-cassandra/target/clb-common-deps-cassandra-3.13.1-CUT-jar-with-dependencies.jar<br/>
/back/clb-parent/clb-common/clb-common-deps-elasticsearch/target/clb-common-deps-elasticsearch-3.13.1-CUT-jar-with-dependencies.jar<br/>
/back/clb-parent/clb-common/clb-common-deps-httpclient/target/clb-common-deps-httpclient-3.13.1-CUT-jar-with-dependencies.jar<br/>
/back/clb-parent/clb-common/clb-common-deps-jms/target/clb-common-deps-jms-3.13.1-CUT-jar-with-dependencies.jar<br/>
/back/clb-parent/clb-common/clb-common-deps-logging/target/clb-common-deps-logging-3.13.1-CUT-jar-with-dependencies.jar<br/>
/back/clb-parent/clb-common/clb-common-deps-sql/target/clb-common-deps-sql-3.13.1-CUT-jar-with-dependencies.jar<br/>
/back/clb-parent/clb-common/clb-common-deps-jackson/target/clb-common-deps-jackson-3.13.1-CUT-jar-with-dependencies.jar</code></div></li>
        <li><p>upload the following files that appears after build of local copy of colaba_back to <b>/usr/local/bin/app/tomcat/<font color="red">&lt;tomcat_home&gt;</font>/webapps/</b>:</p>
            <div style="background-color:silver;"><code>/back/clb-parent/clb-chat-parent/clb-chat-web/target/clb-chat-web.war<br/>
/back/clb-parent/clb-notification-parent/clb-notification-web/target/clb-notification-web.war<br/>
/back/clb-parent/clb-statistics-parent/clb-statistics-web/target/clb-statistics-web.war<br/>
/back/clb-parent/clb-main-parent/clb-web/target/clb-web.war</code></div></li>
        <li><p>upload the following files from clbptmct01 box to <b>/usr/local/bin/app/tomcat/<font color="red">&lt;tomcat_home&gt;</font>/conf/</b>:</p>
            <div style="background-color:silver;"><code>/app/tomcat/apache-tomcat-9.0.21/conf/cassandra.conf<br>
/app/tomcat/apache-tomcat-9.0.21/conf/cassandra.crdt.conf<br>
/app/tomcat/apache-tomcat-9.0.21/conf/context.xml<br>
/app/tomcat/apache-tomcat-9.0.21/conf/log4j2.xml<br>
/app/tomcat/apache-tomcat-9.0.21/conf/server.xml</code></div></li>
        <li><p>(memfis) modify <b>server.xml</b>: change <font color="red">127.0.0.1</font> to <font color="red">&lt;external_ip_of_qirk&gt;</font> in all PostgreSQL resources</p>
        <li><p>(memfis) modify <b>server.xml</b>: change <font color="red">127.0.0.1</font> to <font color="red">&lt;external_ip_of_qirk&gt;</font> in Elasticsearch resource</p>
        <li><p>(memfis) modify <b>server.xml</b>: modify the following rows:</p>
            <div style="background-color: silver;"><code>>>> START server.xml<br/>
&nbsp;&nbsp;&lt;!-- ActiveMQ Self Check Topic --><br/>
&nbsp;&nbsp;&lt;Resource auth="Container" factory="org.apache.activemq.jndi.JNDIReferenceFactory"<br/>
&nbsp;&nbsp;&nbsp;&nbsp;name="jms/topic/clb.selfcheck"<br/>
&nbsp;&nbsp;&nbsp;&nbsp;physicalName="clb.selfcheck<font color="red">2</font>"<br/>
&nbsp;&nbsp;&nbsp;&nbsp;type="org.apache.activemq.command.ActiveMQTopic" /><br/>
<br/>
&nbsp;&nbsp;&lt;!-- ActiveMQ Self Check Queue --><br/>
&nbsp;&nbsp;&lt;Resource auth="Container" factory="org.apache.activemq.jndi.JNDIReferenceFactory"<br/>
&nbsp;&nbsp;&nbsp;&nbsp;name="jms/queue/clb.selfcheck.q"<br/>
&nbsp;&nbsp;&nbsp;&nbsp;physicalName="clb.selfcheck<font color="red">2</font>.q"<br/>
&nbsp;&nbsp;&nbsp;&nbsp;type="org.apache.activemq.command.ActiveMQQueue" /><br/>
>>> FINISH</code></div><br>
to<br>
<br>
<div style="background-color: silver;"><code>>>> START server.xml<br />
&nbsp;&nbsp;&lt;!-- ActiveMQ Self Check Topic --><br/>
&nbsp;&nbsp;&lt;Resource auth="Container" factory="org.apache.activemq.jndi.JNDIReferenceFactory"<br/>
&nbsp;&nbsp;&nbsp;&nbsp;name="jms/topic/clb.selfcheck"<br/>
&nbsp;&nbsp;&nbsp;&nbsp;physicalName="clb.selfcheck<font color="red">1</font>"<br/>
&nbsp;&nbsp;&nbsp;&nbsp;type="org.apache.activemq.command.ActiveMQTopic" /><br/>
<br/>
&nbsp;&nbsp;&lt;!-- ActiveMQ Self Check Queue --><br/>
&nbsp;&nbsp;&lt;Resource auth="Container" factory="org.apache.activemq.jndi.JNDIReferenceFactory"<br/>
&nbsp;&nbsp;&nbsp;&nbsp;name="jms/queue/clb.selfcheck.q"<br/>
&nbsp;&nbsp;&nbsp;&nbsp;physicalName="clb.selfcheck<font color="red">1</font>.q"<br/>
&nbsp;&nbsp;&nbsp;&nbsp;type="org.apache.activemq.command.ActiveMQQueue" /><br/>
>>> FINISH</code></div></li>
        <li><p>(memfis) modify <b>common.properties</b>: add the following rows <font color="red">right after</font> the <b>front.url.decline.invite</b> property:</p>
            <div style="background-color: silver;"><code>>>> START common.properties<br/>
front.url.manage.subscriptions=/manage-subscriptions/<br/>
>>> FINISH</code></div></li>
        <li><p>(memfis) change directory to bin dir of tomcat using the following command:</p>
            <div style="background-color:silver;"><code>$ cd ../bin/</code></div></li>
        <li><p>(memfis) create file <b>setenv.sh</b> with the following content:</p>
            <div style="background-color:silver;"><code>>>> START setenv.sh<br/>
JAVA_OPTS="$JAVA_OPTS -Dlog4j.configurationFile=$CATALINA_HOME/conf/log4j2.xml"<br/>
JAVA_OPTS="$JAVA_OPTS -Xmx1500m"<br/>
>>> FINISH</code></div></li>
        <li><p>(memfis) make <b>setenv.sh</b> executable using the following command:</p>
            <div style="background-color:silver;"><code>$ chmod +x setenv.sh</code></div></li>
        <li><p>(memfis) switch to the root account</p>
            <div style="background-color:silver;"><code>$ su</code></div></li>
        <li><p>(root) create file <b>/etc/systemd/system/tomcat.service</b> with the following content:</p>
            <div style="background-color:silver;"><code>>>> START /etc/systemd/system/tomcat.service<br/>
[Unit]<br/>
Description=Tomcat<br/>
<br/>
[Service]<br/>
Type=forking<br/>
LimitNOFILE=65535<br/>
PIDFile=/usr/local/bin/app/tomcat/apache-tomcat-9.0.24/catalina.pid<br/>
WorkingDirectory=/usr/local/bin/app/tomcat/apache-tomcat-9.0.24/bin<br/>
<br/>
User=memfis<br/>
Group=memfis<br/>
<br/>
OOMScoreAdjust=-100<br/>
<br/>
Environment=JAVA_HOME=/app/java/jdk-11.0.2<br/>
Environment=CATALINA_PID=/usr/local/bin/app/tomcat/apache-tomcat-9.0.24/catalina.pid<br/>
<br/>
ExecStart=/usr/local/bin/app/tomcat/apache-tomcat-9.0.24/bin/startup.sh<br/>
ExecStop=/usr/local/bin/app/tomcat/apache-tomcat-9.0.24/bin/shutdown.sh<br/>
TimeoutSec=300<br/>
<br/>
[Install]<br/>
WantedBy=multi-user.target<br/>
>>> FINISH</code></div></li>
        <li><p>(root) check status of the service script</p>
            <div style="background-color:silver;"><code># systemctl status tomcat</code></div></li>
        <li><p>(root)  output of the command above must be the following:</p>
            <div style="background-color:silver;"><code>tomcat.service - Tomcat<br/>
Loaded: loaded (/etc/systemd/system/tomcat.service; disabled; vendor preset: disabled)<br/>
Active: inactive (dead)</code></div></li>
        <li><p>(root) enable the service script using the following command:</p>
            <div style="background-color:silver;"><code># systemctl enable tomcat</code></div></li>
        <li><p>(root) run tomcat service using the following command:</p>
            <div style="background-color:silver;"><code># systemctl start tomcat</code></div></li>
    </ol>
    <h2>Migrate Memfis from another machine. Date 2020-01-24</h2>
    <ol>
        <li><p>login <b>qirk</b> box via ssh using <b>memfis</b> account</p>
            <div style="background-color:silver;"><code></code></div></li>
        <li><p>from <b>clbptmct01</b> box upload the following file to <b>/home/memfis/psql/</b> directory using any sftp client:</p>
            <div style="background-color:silver;"><code>/home/memfis/psql/clb.sql</code></div></li>
        <li><p>from <b>clbptmct01</b> box upload the following file to <b>/home/memfis/psql/auth/</b> directory using any sftp client:</p>
            <div style="background-color:silver;"><code>/home/memfis/psql/clb_auth.sql</code></div></li>
        <li><p>from <b>clbptmct01</b> box upload the following file to <b>/home/memfis/psql/notif/</b> directory using any sftp client:</p>
            <div style="background-color:silver;"><code>/home/memfis/psql/clb_notif.sql</code></div></li>
        <li><p>from <b>clbptmct01</b> box upload the following file to <b>/home/memfis/psql/stat/</b> directory using any sftp client:</p>
            <div style="background-color:silver;"><code>/home/memfis/psql/clb_stat.sql</code></div></li>
        <li><p>(memfis) execute the following commands to setup postgresql database (require <a href="#psql_postgres_password">password of postgres</a> user on <b>first two steps</b> and <a href="#psql_hibernate_password">password for hibernate</a> user on the next commands)</p>
            <div style="background-color:silver;"><code>$ psql -U hibernate -d clb -a -f clb.sql<br/>
$ psql -U hibernate -d clb_auth -a -f auth/clb_auth.sql<br/>
$ psql -U hibernate -d clb_notif -a -f notif/clb_notif.sql<br/>
$ psql -U hibernate -d clb_stat -a -f stat/clb_stat.sql</code></div></li>
        <li><p>(memfis) delete database backup</p>
            <div style="background-color:silver;"><code>$ rm clb.sql<br/>
$ rm auth/clb_auth.sql<br/>
$ rm notif/clb_notif.sql<br/>
$ rm stat/clb_stat.sql</code></div></li>
        <li><p>(memfis) change directory to /home/memfis/elasticsearch/ using the following command:</p>
            <div style="background-color:silver;"><code>$ cd ~/elasticsearch/</code></div></li>
        <li><p>(memfis) execute script to synchronize elasticsearch with PostreSQL data using the following command (press Ctrl+C after <b>Synchronizing tasks: finish</b> log):</p>
            <div style="background-color:silver;"><code>$ java -jar clb-elasticsearch-datasync-3.13.1-CUT.jar datasync.properties</code></div></li>
        <li><p>(memfis) switch to the root account</p>
            <div style="background-color:silver;"><code>$ su</code></div></li>
        <li><p>(memfis) run tomcat using the following command</p>
            <div style="background-color:silver;"><code># service tomcat.service start</code></div></li>
    </ol>

</body>
</html>
